{
    "lists": {},
    "forms": {},
    "js": {},
    "methods": {
        "getItemList": {
            "script": {
                "py": "from apng_core.db import fetchall\n\nSQL = \"\"\"\n    SELECT o.id, o.type_code, o.code, o.name_en, o.name_ru, o.name_combined,\n           o.icon, o.resource_url, o.availability_condition,\n           string_agg(os.state_code, ', ' ORDER BY os.state_code) as states\n    FROM process_operation o\n    LEFT JOIN process_operation_states os ON o.id = os.operation_id\n    GROUP BY o.id, o.type_code, o.code, o.name_en, o.name_ru, o.name_combined,\n             o.icon, o.resource_url, o.availability_condition\n    ORDER BY o.type_code, o.code\n\"\"\"\n\nwith initDbSession(database='default').cursor() as c:\n    c.execute(SQL)\n    data = fetchall(c)\n"
            }
        }
    },
    "references": {
        "default": {
            "form": {
                "style": {
                    "width": "1400px",
                    "height": "600px"
                },
                "columns": [
                    {
                        "title": "Type",
                        "field": "type_code",
                        "width": 100
                    },
                    {
                        "title": "Code",
                        "field": "code",
                        "width": 120
                    },
                    {
                        "title": "Name (English)",
                        "field": "name_en",
                        "width": 180
                    },
                    {
                        "title": "Name (Russian)",
                        "field": "name_ru",
                        "width": 180
                    },
                    {
                        "title": "Combined Name",
                        "field": "name_combined",
                        "flex": 1
                    },
                    {
                        "title": "Icon",
                        "field": "icon",
                        "width": 100
                    },
                    {
                        "title": "States",
                        "field": "states",
                        "width": 200
                    },
                    {
                        "title": "Resource URL",
                        "field": "resource_url",
                        "width": 250
                    }
                ],
                "keyField": "id",
                "titleField": "name_combined",
                "method": "getItemList",
                "filter": {
                    "className": "vertical",
                    "$": {
                        "type_code": {
                            "label": "Document Type",
                            "control": "SelectEdit",
                            "controlProps": {
                                "object": "processType",
                                "method": "getItemList",
                                "valueField": "code",
                                "displayField": "name_combined"
                            }
                        },
                        "code": {
                            "label": "Operation Code",
                            "control": "TextEdit"
                        },
                        "name": {
                            "label": "Name",
                            "control": "TextEdit"
                        }
                    }
                },
                "filterMethod": {
                    "script": {
                        "py": "from apng_core.db import fetchall\n\nSQL = \"\"\"\n    SELECT o.id, o.type_code, o.code, o.name_en, o.name_ru, o.name_combined,\n           o.icon, o.resource_url, o.availability_condition,\n           string_agg(os.state_code, ', ' ORDER BY os.state_code) as states\n    FROM process_operation o\n    LEFT JOIN process_operation_states os ON o.id = os.operation_id\n    WHERE 1=1\n\"\"\"\n\nparams = {}\n\nif parameters.get('type_code'):\n    SQL += \" AND o.type_code = :type_code\"\n    params['type_code'] = parameters['type_code']\n\nif parameters.get('code'):\n    SQL += \" AND UPPER(o.code) LIKE UPPER(:code)\"\n    params['code'] = f\"%{parameters['code']}%\"\n\nif parameters.get('name'):\n    SQL += \" AND (UPPER(o.name_en) LIKE UPPER(:name) OR UPPER(o.name_ru) LIKE UPPER(:name) OR UPPER(o.name_combined) LIKE UPPER(:name))\"\n    params['name'] = f\"%{parameters['name']}%\"\n\nSQL += \"\"\"\n    GROUP BY o.id, o.type_code, o.code, o.name_en, o.name_ru, o.name_combined,\n             o.icon, o.resource_url, o.availability_condition\n    ORDER BY o.type_code, o.code\n\"\"\"\n\nwith initDbSession(database='default').cursor() as c:\n    c.execute(SQL, params)\n    data = fetchall(c)\n"
                    }
                }
            }
        }
    }
}
