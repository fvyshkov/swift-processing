{
    "forms": {
        "pledgesForm": {
            "title": "Залоги",
            "className": "vertical",
            "$": {
                "@pledge": {
                    "title": "Залоги",
                    "titleClass": "navigated-title",
                    "className": "vertical navigated-content",
                    "style": {
                        "width": "860px"
                    },
                    "$": {
                        "withoutPledge": {
                            "label": "Без обеспечения",
                            "control": "Checkbox",
                            "default": false,
                            "actions": {
                                "onChange": {
                                    "name": "refresh"
                                }
                            },
                            "visible$": "!params.disableWithoutPledge",
                            "validate": "!params.disableWithoutPledge && !mem.withoutPledge && mem.pledges.length==0 && {helperText: 'Не введено обеспечение'}||true"
                        },
                        "@list": {
                            "object": "appPledge",
                            "form": "pledgeListForm",
                            "visible$": "!mem.withoutPledge || !!params.disableWithoutPledge"
                        }
                    },
                    "actions": {
                        "refresh": {
                            "js": ";"
                        }
                    }
                }
            }
        },
        "pledgeListForm": {
            "title": "Залоги",
            "className": "vertical",
            "$": {
                ".ap": {
                    "control": "ActionPanel",
                    "controlOpts": {
                        "actions": [
                            {
                                "title": "Добавить",
                                "icon": "add",
                                "split": true,
                                "actions$": "context.pledgeTypes?.map?.((t)=>{return {title: t.name, command: ()=>{context.selectedPledge = null; frontend.dialog({object: 'appPledge', form: 'pledgeAnyDialog', mem: {pledge: {type: t.code, typeName: t.name, baseType: t.baseType, ens_code: t.ens_code, ens_name: t.ens_name}}, params: params})}}})",
                                "disabled$": "isReadOnly"
                            },
                            {
                                "title": "Просмотр",
                                "icon": "view",
                                "mini": true,
                                "action": {
                                    "js": "frontend.dialog({object: 'appPledge', form: 'pledgeAnyDialog', mem: {pledge: {...context.selectedPledge}}, params: {params, readOnly:isReadOnly}});"
                                },
                                "disabled$": "!context.selectedPledge"
                            },
                            {
                                "title": "Удалить",
                                "icon": "delete",
                                "mini": true,
                                "action": {
                                    "name": "deletePledge",
                                    "confirm": {
                                        "title": "Удаление",
                                        "message$": "`Удалить объект обеспечения ${context.selectedPledge.description||context.selectedPledge.ens_name}`",
                                        "yes": "Да",
                                        "no": "Нет"
                                    }
                                },
                                "disabled$": "isReadOnly || !context.selectedPledge ||context.selectedPledge?.isObjectOfCredit"
                            }
                        ]
                    }
                },
                "|pledges": {
                    "className": "vertical",
                    "style": {
                        "marginBottom": "4px"
                    },
                    "control": "ListTable",
                    "controlProps": {
                        "context$": "context"
                    },
                    "controlOpts": {
                        "columns!": {
                            "type": {
                                "label": "Тип залога",
                                "width": 200,
                                "getter": "context?.pledgeTypes?.find((t)=>t.code==data?.type)?.name"
                            },
                            "description": {
                                "label": "Описание",
                                "flex": 1,
                                "cellStyle": {
                                    "whiteSpace": "normal !important",
                                    "lineHeight": 1.2,
                                    "display": "flex",
                                    "alignItems": "center"
                                }
                            },
                            "mortgage_value": {
                                "label": "Залоговая стоимость",
                                "cellStyle": {
                                    "textAlign": "right"
                                },
                                "fields|": {
                                    "cost": {
                                        "getter": "data.mortgage_value",
                                        "format": "currency"
                                    },
                                    "currency": {
                                        "getter": "data.mortgage_value_currency"
                                    }
                                }
                            },
                            "fair_value": {
                                "label": "Справедливая стоимость",
                                "cellStyle": {
                                    "textAlign": "right"
                                },
                                "fields|": {
                                    "cost": {
                                        "getter": "data.fair_value",
                                        "format": "currency"
                                    },
                                    "currency": {
                                        "getter": "data.fair_value_currency"
                                    }
                                }
                            }
                        }
                    },
                    "actions": {
                        "onRowDoubleClicked": {
                            "name": "viewPledge",
                            "params": {
                                "client$": "params.client"
                            }
                        }
                    }
                }
            },
            "actions": {
                "viewPledge": {
                    "js": "frontend.dialog({object: 'appPledge', form: 'pledgeAnyDialog', mem: {pledge: {...context.selectedPledge}}, params: params});"
                },
                "onSavePledge": {
                    "js": "if (mem.pledges.indexOf(context.selectedPledge)>=0) {mem.pledges.splice(mem.pledges.indexOf(context.selectedPledge), 1, params.pledge); context.selectedPledge = params.pledge} else {mem.pledges.push(params.pledge); context.selectedPledge = null;} mem.pledges = [...mem.pledges];"
                },
                "deletePledge": {
                    "js": "mem.pledges.splice(mem.pledges.indexOf(context.selectedPledge), 1); mem.pledges = [...mem.pledges]; context.selectedPledge = null; forceUpdate()"
                },
                "closeDialog": {
                    "js": "dialog.actions.close();"
                },
                "onSelectionChanged": {
                    "js": "context.selectedPledge = selectedRow;"
                },
                "onElementCreated": [
                    {
                        "js": "if(context.pledgeTypes===undefined){context.pledgeTypes=null; return backend.post('/aoa/execObjectMethod', {object: 'appPledge', method: 'getPledgeTypes'}, {useCache: true}).then((r)=>{context.pledgeTypes=r.filter((t)=>!t.hide); mem.pledges = [...mem.pledges]; forceUpdate();});}",
                        "disableUpdate": true
                    }
                ]
            }
        },
        "pledgeAnyDialog": {
            "title$": "`Обеспечение: ${mem.pledge?.typeName}`",
            "className": "vertical",
            "style": {
                "overflow": "hidden"
            },
            "$": {
                "@fields": {
                    "className": "vertical",
                    "style": {
                        "paddingTop": "8px",
                        "overflowY": "auto"
                    },
                    "$": {
                        "pledge": {
                            "className": "vertical",
                            "$": {
                                "@enscode": {
                                    "className": "horizontal",
                                    "$": {
                                        "ens_code": {
                                            "label": "Вид обеспечения",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "ObjectReference",
                                            "controlProps": {
                                                "object": "pledgeType",
                                                "reference": "default",
                                                "textReadOnly": true
                                            },
                                            "controlOpts": {
                                                "referenceParams": {
                                                    "baseType$": "mem.baseType"
                                                }
                                            },
                                            "required": true,
                                            "actions": {
                                                "onChange": {
                                                    "name": "onChangeEnsCode"
                                                }
                                            }
                                        },
                                        "ens_name": {
                                            "style": {
                                                "width": "560px"
                                            },
                                            "control": "TextEdit",
                                            "readOnly": true
                                        }
                                    }
                                },
                                "@pledgeDetail": {
                                    "form$": "`pledge-${mem.type}-Form`",
                                    "visible$": "!!mem.type"
                                }
                            }
                        }
                    },
                    "readOnly$": "!!mem.pledge.isObjectOfCredit || params.readOnly",
                    "actions": {
                        "onChangeEnsCode": {
                            "js": "mem.pledge.ens_name=params.row.name;"
                        }
                    }
                },
                "@buttons": {
                    "className": "horizontal",
                    "style": {
                        "justifyContent": "end"
                    },
                    "$": {
                        ".btnCancel": {
                            "label": "Отменить",
                            "control": "Button",
                            "controlProps": {
                                "variant": "outlined",
                                "color": "primary"
                            },
                            "action": {
                                "js": "actions.close();",
                                "disableUpdate": true
                            }
                        },
                        ".btnApply": {
                            "label": "Сохранить",
                            "control": "Button",
                            "controlProps": {
                                "variant": "contained",
                                "color": "primary"
                            },
                            "readOnly$": "!!mem.pledge.isObjectOfCredit || params.readOnly",
                            "action": [
                                {
                                    "js": "if (!validate()){throw 'Abort';}"
                                },
                                {
                                    "name": "onSavePledge",
                                    "params": {
                                        "pledge$": "mem.pledge"
                                    }
                                },
                                {
                                    "js": "actions.close();",
                                    "disableUpdate": true
                                }
                            ]
                        }
                    }
                }
            },
            "actions": {
                "onElementCreated": {
                    "js": "backend.post('/aoa/execObjectMethod', {object: 'settings', method: 'get'}, {useCache: true, silent: true}).then(r=>{context.myIdVisible = r?.loanapp?.identifyMyId; context.identifyPin = r?.loanapp?.identifyPin; forceUpdate();})"
                }
            }
        },
        "cadastrNoControl": {
            "title": "Кадастровый номер",
            "$": {
                ".field": {
                    "label$": "params.label || 'Кадастровый номер'",
                    "control": "TextEdit",
                    "controlProps": {
                        "masked": {
                            "mask": [
                                "/\\d/",
                                "/\\d/",
                                ":",
                                "/\\d/",
                                "/\\d/",
                                ":",
                                "/\\d/",
                                "/\\d/",
                                ":",
                                "/\\d/",
                                "/\\d/",
                                ":",
                                "/\\d/",
                                "/\\d/",
                                ":",
                                "/\\d/",
                                "/\\d/",
                                "/\\d/",
                                "/\\d/",
                                ":",
                                "/\\d/",
                                "/\\d/",
                                "/\\d/",
                                "/\\d/",
                                ":",
                                "/\\d/",
                                "/\\d/",
                                "/\\d/"
                            ],
                            "placeholderChar": "_",
                            "showMask": true,
                            "guide": true
                        }
                    },
                    "controlOpts": {
                        "toValue": "((params.value||'').match(/\\d+/g) || []).join(':')"
                    },
                    "validate": [
                        "!validator.required && !mem || undefined",
                        "mem.search('(^00:)|(:00:)|(:0000:)|(:000$)')>=0 && {helperText: 'Неправильное значение номера'} || undefined",
                        "mem.search('[_]{2}:[_]{2}:[_]{2}:[_]{2}:[_]{2}:[_]{4}:[_]{4}:[_]{3}')==0 || undefined",
                        "mem.search('[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{4}$')==0 || undefined",
                        "mem.search('[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{4}:[_]{4}:[_]{3}')==0 || undefined",
                        "mem.search('[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{4}:[0-9]{4}$')==0 || undefined",
                        "mem.search('[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{4}:[0-9]{4}:[_]{3}')==0 || undefined",
                        "mem.search('[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{2}:[0-9]{4}:[0-9]{4}:[0-9]{3}')==0 || undefined",
                        "{helperText: 'Неправильное значение номера'}"
                    ]
                }
            }
        },
        "addressEditForm": {
            "title": "Адрес залога",
            "className": "vertical",
            "$": {
                "@region": {
                    "className": "horizontal",
                    "$": {
                        "region": {
                            "label": "Код области",
                            "style": {
                                "width": "280px"
                            },
                            "control": "ObjectReference",
                            "controlProps": {
                                "object": "addressRegion",
                                "reference": "default"
                            },
                            "controlOpts": {
                                "postfixFields": {
                                    "Name": "name"
                                }
                            },
                            "actions": {
                                "onChange": {
                                    "name": "onRegionChanged"
                                }
                            }
                        },
                        "regionName": {
                            "style": {
                                "width": "560px"
                            },
                            "control": "TextEdit",
                            "readOnly": true,
                            "required": false
                        }
                    }
                },
                "@district": {
                    "className": "horizontal",
                    "$": {
                        "district": {
                            "label": "Код района",
                            "style": {
                                "width": "280px"
                            },
                            "control": "ObjectReference",
                            "controlProps": {
                                "object": "addressDistrict",
                                "reference": "default",
                                "params": {
                                    "region$": "mem.region"
                                }
                            },
                            "controlOpts": {
                                "postfixFields": {
                                    "Name": "name"
                                }
                            }
                        },
                        "districtName": {
                            "style": {
                                "width": "560px"
                            },
                            "control": "TextEdit",
                            "readOnly": true,
                            "required": false
                        }
                    }
                },
                "address": {
                    "label": "Адрес",
                    "style": {
                        "width": "850px"
                    },
                    "control": "TextEdit"
                }
            },
            "actions": {
                "onRegionChanged": {
                    "js": "mem.district = null;"
                }
            }
        },
        "clientEditForm": {
            "title": "Ввод клиента",
            "className": "horizontal",
            "$": {
                "code": {
                    "label$": "params.label || 'Код'",
                    "style": {
                        "width": "280px"
                    },
                    "control": "ButtonTextEdit",
                    "controlProps": {
                        "textReadOnly": true
                    },
                    "action": {
                        "js": "frontend.dialog({object: 'appPledge', form: 'clientIdentDialog', mem: {}, context: {...context}, params: {borrower: params.client, enableIdentifyJur: params?.enableIdentifyJur}})"
                    }
                },
                "name": {
                    "label": "",
                    "style": {
                        "width": "560px"
                    },
                    "control": "TextEdit",
                    "readOnly": true
                }
            },
            "actions": {
                "onClientIdentified": [
                    {
                        "js": "validator.$.code.error=false; mem.code = params.client.code; mem.name = params.client.name; mem.myId = params.myId;"
                    },
                    {
                        "name": "onClientModified"
                    }
                ]
            }
        },
        "clientIdentDialog": {
            "title": "Идентификация клиента",
            "$": {
                "@wrapper": {
                    "object": "loanapp.pledge",
                    "form": "clientIdentDialog"
                }
            }
        },
        "pledge-REALTY-RESIDENTAL-Form": {
            "title": "Жилая недвижимость",
            "className": "vertical",
            "$": {
                "description": {
                    "label": "Наименование залога",
                    "control": "TextEdit",
                    "required": true
                },
                "@cost": {
                    "className": "horizontal",
                    "$": {
                        "mortgage_value": {
                            "label": "Залоговая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "mortgage_value_currency"
                            },
                            "required": true
                        },
                        "fair_value": {
                            "label": "Справедливая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "fair_value_currency"
                            },
                            "required": true
                        }
                    }
                },
                "@g1": {
                    "className": "horizontal",
                    "$": {
                        "cadastr_no": {
                            "init": "",
                            "style": {
                                "width": "280px"
                            },
                            "$": {
                                "@control": {
                                    "object": "appPledge",
                                    "form": "cadastrNoControl",
                                    "required": true
                                }
                            }
                        },
                        "square_com": {
                            "label": "Площадь",
                            "style": {
                                "width": "140px"
                            },
                            "control": "NumericField",
                            "controlProps": {
                                "numericProps": {
                                    "decimalPlaces": 2
                                },
                                "InputProps": {
                                    "endAdornment": "м2"
                                }
                            }
                        },
                        "square_live": {
                            "label": "Жилая площадь",
                            "style": {
                                "width": "140px"
                            },
                            "control": "NumericField",
                            "controlProps": {
                                "numericProps": {
                                    "decimalPlaces": 2
                                },
                                "InputProps": {
                                    "endAdornment": "м2"
                                }
                            }
                        },
                        "apartments": {
                            "label": "Кол-во комнат",
                            "style": {
                                "width": "140px"
                            },
                            "control": "PositiveIntegerField"
                        }
                    }
                },
                "@g2": {
                    "className": "horizontal",
                    "$": {
                        "cadastr_no_land": {
                            "init": "",
                            "style": {
                                "width": "280px"
                            },
                            "$": {
                                "@control": {
                                    "object": "appPledge",
                                    "form": "cadastrNoControl",
                                    "required": false
                                }
                            },
                            "params": {
                                "label": "Кадастровый номер земельного участка"
                            }
                        },
                        "square_land": {
                            "label": "Площадь земельного участка",
                            "style": {
                                "width": "280px"
                            },
                            "control": "NumericField",
                            "controlProps": {
                                "numericProps": {
                                    "decimalPlaces": 2
                                },
                                "InputProps": {
                                    "endAdornment": "м2"
                                }
                            }
                        }
                    }
                },
                "address": {
                    "$": {
                        "@address": {
                            "object": "appPledge",
                            "form": "addressEditForm",
                            "required": true
                        }
                    }
                },
                "@owner": {
                    "object": "appPledge",
                    "form": "ownerEditForm",
                    "required": true
                }
            }
        },
        "pledge-REALTY-NON-RESIDENTAL-Form": {
            "title": "Нежилая недвижимость",
            "className": "vertical",
            "$": {
                "description": {
                    "label": "Наименование залога",
                    "control": "TextEdit",
                    "required": true
                },
                "@cost": {
                    "className": "horizontal",
                    "$": {
                        "mortgage_value": {
                            "label": "Залоговая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "mortgage_value_currency"
                            },
                            "required": true
                        },
                        "fair_value": {
                            "label": "Справедливая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "fair_value_currency"
                            },
                            "required": true
                        }
                    }
                },
                "@g1": {
                    "className": "horizontal",
                    "$": {
                        "cadastr_no": {
                            "init": "",
                            "style": {
                                "width": "280px"
                            },
                            "$": {
                                "@control": {
                                    "object": "appPledge",
                                    "form": "cadastrNoControl",
                                    "required": true
                                }
                            }
                        },
                        "square_com": {
                            "label": "Площадь",
                            "style": {
                                "width": "280px"
                            },
                            "control": "NumericField",
                            "controlProps": {
                                "numericProps": {
                                    "decimalPlaces": 2
                                },
                                "InputProps": {
                                    "endAdornment": "м2"
                                }
                            }
                        }
                    }
                },
                "@g2": {
                    "className": "horizontal",
                    "$": {
                        "cadastr_no_land": {
                            "init": "",
                            "style": {
                                "width": "280px"
                            },
                            "$": {
                                "@control": {
                                    "object": "appPledge",
                                    "form": "cadastrNoControl",
                                    "required": false
                                }
                            },
                            "params": {
                                "label": "Кадастровый номер земельного участка"
                            }
                        },
                        "square_land": {
                            "label": "Площадь земельного участка",
                            "style": {
                                "width": "280px"
                            },
                            "control": "NumericField",
                            "controlProps": {
                                "numericProps": {
                                    "decimalPlaces": 2
                                },
                                "InputProps": {
                                    "endAdornment": "м2"
                                }
                            }
                        }
                    }
                },
                "address": {
                    "$": {
                        "@address": {
                            "object": "appPledge",
                            "form": "addressEditForm",
                            "required": true
                        }
                    }
                },
                "@owner": {
                    "object": "appPledge",
                    "form": "ownerEditForm",
                    "params": {
                        "enableIdentifyJur": true
                    },
                    "required": true
                }
            }
        },
        "pledge-AUTO-Form": {
            "title": "Автотранспорт",
            "className": "vertical",
            "$": {
                "@vehicle_type": {
                    "className": "horizontal",
                    "$": {
                        "vehicle_type": {
                            "label": "Тип ТС",
                            "style": {
                                "width": "280px"
                            },
                            "control": "ObjectReference",
                            "controlProps": {
                                "object": "bank_domain",
                                "reference": "default"
                            },
                            "controlOpts": {
                                "referenceParams": {
                                    "domain": "M_AUTOCAT"
                                },
                                "postfixFields": {
                                    "_name": "name"
                                }
                            },
                            "required": true
                        },
                        "vehicle_type_name": {
                            "style": {
                                "width": "560px"
                            },
                            "control": "TextEdit",
                            "required": false,
                            "readOnly": true
                        }
                    }
                },
                "@vehicle_model": {
                    "className": "horizontal",
                    "$": {
                        "vehicle_model": {
                            "label": "Марка/модель",
                            "style": {
                                "width": "280px"
                            },
                            "control": "ObjectReference",
                            "controlProps": {
                                "object": "vehicleModel",
                                "reference": "default"
                            },
                            "controlOpts": {
                                "referenceParams": {},
                                "valueField": "name"
                            },
                            "required": true
                        },
                        "issue_year": {
                            "label": "Год выпуска",
                            "style": {
                                "width": "120px"
                            },
                            "control": "NumericField",
                            "controlProps": {
                                "numericProps": {
                                    "maximumValue$": "(new Date()).getFullYear()"
                                }
                            },
                            "required": true
                        },
                        "reg_ser": {
                            "label": "Серия",
                            "style": {
                                "width": "160px"
                            },
                            "control": "TextEdit",
                            "controlProps": {
                                "inputProps": {
                                    "maxLength": 10
                                }
                            },
                            "required": true
                        },
                        "reg_num": {
                            "label": "Номер",
                            "style": {
                                "width": "160px"
                            },
                            "control": "TextEdit",
                            "controlProps": {
                                "inputProps": {
                                    "maxLength": 30
                                }
                            },
                            "required": true
                        }
                    }
                },
                "@value": {
                    "className": "horizontal",
                    "$": {
                        "mortgage_value": {
                            "label": "Залоговая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "mortgage_value_currency"
                            },
                            "required": true
                        },
                        "fair_value": {
                            "label": "Справедливая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "fair_value_currency"
                            },
                            "required": true
                        }
                    }
                },
                "description": {
                    "label": "Наименование залога",
                    "control": "TextEdit",
                    "required": true
                },
                "@owner": {
                    "object": "appPledge",
                    "form": "ownerEditForm",
                    "params": {
                        "enableIdentifyJur": true
                    },
                    "required": true
                }
            }
        },
        "pledge-SURETY-Form": {
            "title": "Гарант/Поручитель",
            "className": "vertical",
            "$": {
                "mortgage_value": {
                    "label": "Залоговая стоимость",
                    "style": {
                        "width": "280px"
                    },
                    "control": "CurrencyField",
                    "controlOpts": {
                        "currencyAttr": "mortgage_value_currency"
                    },
                    "required": true
                },
                "@owner": {
                    "$": {
                        "@owner": {
                            "object": "appPledge",
                            "form": "ownerEditForm",
                            "required": true,
                            "params": {
                                "label": "Гарант/Поручитель"
                            }
                        },
                        ".validate": {
                            "control": "Text",
                            "getter": "validator.helperText",
                            "style": {
                                "color": "#f44336"
                            },
                            "visible$": "!!validator.helperText"
                        }
                    },
                    "validate": [
                        "mem.owner.code == params.client.code && {helperText: 'Заемщик не может быть поручителем'} || undefined",
                        "params.coborrowers?.find((c)=>c.customer.code==mem.owner.code) && {helperText: 'Созаемщик не может быть поручителем'} || undefined"
                    ],
                    "actions": {
                        "onOwnerModified": {
                            "js": "validator.error=false; validator.helperText=null; mem.description = mem.owner.name;"
                        }
                    }
                }
            },
            "actions": {
                "setOwner": {
                    "js": "mem.owner.code=params.client.code; mem.owner.name=params.client.name; mem.owner.myId=params.myId; mem.description = mem.owner.name;"
                }
            }
        },
        "pledge-INSURANCE-Form": {
            "title": "Страховка",
            "$": {
                "mortgage_value": {
                    "label": "Залоговая стоимость",
                    "style": {
                        "width": "280px"
                    },
                    "control": "CurrencyField",
                    "controlOpts": {
                        "currencyAttr": "mortgage_value_currency"
                    },
                    "required": true
                }
            }
        },
        "pledge-DEPO-Form": {
            "title": "Депозит",
            "className": "vertical",
            "$": {
                "deposit": {
                    "className": "vertical",
                    "$": {
                        "depositType": {
                            "init": "internal",
                            "control": "RadioGroup",
                            "controlProps": {
                                "row": true,
                                "list": [
                                    {
                                        "value": "internal",
                                        "name": "В нашем банке"
                                    },
                                    {
                                        "value": "external",
                                        "name": "В другом банке"
                                    },
                                    {
                                        "value": "future",
                                        "name": "Предстоящий"
                                    }
                                ]
                            },
                            "actions": {
                                "onChange": {
                                    "name": "onChangeDepositType"
                                }
                            }
                        },
                        "@internal": {
                            "className": "vertical",
                            "visible$": "mem.depositType == 'internal'",
                            "$": {
                                ".btnFindDeposit": {
                                    "label": "Найти договор",
                                    "control": "Button",
                                    "controlProps": {
                                        "style": {
                                            "textTransform": "none"
                                        },
                                        "color": "primary"
                                    },
                                    "action": {
                                        "js": "frontend.dialog({object: 'appPledge', form: 'selectClientDepositDialog', mem: {}, params: params})"
                                    }
                                },
                                "product_name": {
                                    "label": "Продукт",
                                    "control": "TextEdit",
                                    "readOnly": true
                                },
                                "@g1": {
                                    "className": "horizontal",
                                    "$": {
                                        "number": {
                                            "label": "номер",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "TextEdit"
                                        },
                                        "date": {
                                            "label": "Дата",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "DateEdit"
                                        },
                                        "endDate": {
                                            "label": "Дата окончания",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "DateEdit"
                                        }
                                    },
                                    "readOnly": true
                                },
                                "@g2": {
                                    "className": "horizontal",
                                    "$": {
                                        "cli_code": {
                                            "label": "Код клиента",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "TextEdit"
                                        },
                                        "cli_name": {
                                            "label": "Наименование клиента",
                                            "style": {
                                                "width": "560px"
                                            },
                                            "control": "TextEdit"
                                        }
                                    },
                                    "readOnly": true
                                },
                                "amount": {
                                    "label": "Сумма депозита",
                                    "style": {
                                        "width": "280px"
                                    },
                                    "control": "CurrencyField",
                                    "controlOpts": {
                                        "currencyAttr": "amount_currency"
                                    },
                                    "readOnly": true
                                }
                            },
                            "actions": {
                                "onDepositSelected": [
                                    {
                                        "js": "console.log('onDepositSelected', params.deposit);"
                                    },
                                    {
                                        "js": "mem.product_name=params.deposit.productName; mem.number=params.deposit.code; mem.date=params.deposit.fromDate; mem.endDate=params.deposit.toDate; mem.cli_code=params.deposit.clientCode; mem.cli_name=params.deposit.clientName; mem.amount=params.deposit.amount; mem.amount_currency=params.deposit.currency;"
                                    }
                                ]
                            }
                        },
                        "@external": {
                            "visible$": "mem.depositType == 'external'",
                            "className": "vertical",
                            "$": {
                                "bank_name": {
                                    "label": "Банк в котором открыт депозит",
                                    "control": "TextEdit",
                                    "required": true
                                },
                                "@g1": {
                                    "className": "horizontal",
                                    "$": {
                                        "number": {
                                            "label": "номер",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "TextEdit",
                                            "required": true
                                        },
                                        "date": {
                                            "label": "Дата",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "DateEdit",
                                            "required": true
                                        },
                                        "endDate": {
                                            "label": "Дата окончания",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "DateEdit",
                                            "required": true
                                        }
                                    }
                                },
                                "depositor_name": {
                                    "label": "Наименование вкладчика",
                                    "control": "TextEdit",
                                    "required": true
                                },
                                "amount": {
                                    "label": "Сумма депозита",
                                    "style": {
                                        "width": "280px"
                                    },
                                    "control": "CurrencyField",
                                    "controlOpts": {
                                        "currencyAttr": "amount_currency"
                                    },
                                    "required": true
                                }
                            }
                        }
                    },
                    "actions": {
                        "onChangeDepositType": {
                            "js": ";"
                        }
                    }
                },
                "mortgage_value": {
                    "label": "Залоговая стоимость",
                    "style": {
                        "width": "280px"
                    },
                    "control": "CurrencyField",
                    "controlOpts": {
                        "currencyAttr": "mortgage_value_currency"
                    },
                    "required": true
                }
            }
        },
        "pledge-EQUIP-Form": {
            "title": "Оборудование",
            "className": "vertical",
            "$": {
                "description": {
                    "label": "Наименование залога",
                    "control": "TextEdit",
                    "required": true
                },
                "equipment": {
                    "className": "vertical",
                    "$": {
                        "@g1": {
                            "className": "horizontal",
                            "$": {
                                "issue_year": {
                                    "label": "Год выпуска",
                                    "style": {
                                        "width": "280px"
                                    },
                                    "control": "NumericField",
                                    "required": true,
                                    "controlProps": {
                                        "numericProps": {
                                            "maximumValue$": "(new Date()).getFullYear()"
                                        }
                                    }
                                },
                                "issue_month": {
                                    "label": "Месяц выпуска",
                                    "style": {
                                        "width": "280px"
                                    },
                                    "control": "NumericField",
                                    "required": true,
                                    "controlProps": {
                                        "numericProps": {
                                            "maximumValue": 12
                                        }
                                    }
                                }
                            }
                        },
                        "content": {
                            "label": "Описание",
                            "control": "TextEdit",
                            "controlProps": {
                                "multiline": true,
                                "minRows": 4
                            },
                            "required": true
                        }
                    }
                },
                "@cost": {
                    "className": "horizontal",
                    "$": {
                        "mortgage_value": {
                            "label": "Залоговая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "mortgage_value_currency"
                            },
                            "required": true
                        },
                        "fair_value": {
                            "label": "Справедливая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "fair_value_currency"
                            },
                            "required": true
                        }
                    }
                },
                "@owner": {
                    "object": "appPledge",
                    "form": "ownerEditForm",
                    "required": true
                }
            }
        },
        "pledge-GOOD-Form": {
            "title": "Товары в обороте",
            "$": {
                "@other": {
                    "object": "appPledge",
                    "form": "pledge-OTHER-Form"
                }
            }
        },
        "pledge-STEAD-Form": {
            "title": "Земельный участок",
            "className": "vertical",
            "$": {
                "description": {
                    "label": "Наименование залога",
                    "control": "TextEdit",
                    "required": true
                },
                "@cost": {
                    "className": "horizontal",
                    "$": {
                        "mortgage_value": {
                            "label": "Залоговая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "mortgage_value_currency"
                            },
                            "required": true
                        },
                        "fair_value": {
                            "label": "Справедливая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "fair_value_currency"
                            },
                            "required": true
                        }
                    }
                },
                "@g1": {
                    "className": "horizontal",
                    "$": {
                        "cadastr_no_land": {
                            "init": "",
                            "style": {
                                "width": "280px"
                            },
                            "$": {
                                "@control": {
                                    "object": "appPledge",
                                    "form": "cadastrNoControl",
                                    "required": false
                                }
                            },
                            "params": {
                                "label": "Кадастровый номер земельного участка"
                            }
                        },
                        "square_land": {
                            "label": "Общая площадь участка",
                            "style": {
                                "width": "140px"
                            },
                            "control": "NumericField",
                            "controlProps": {
                                "numericProps": {
                                    "decimalPlaces": 2
                                },
                                "InputProps": {
                                    "endAdornment": "м2"
                                }
                            }
                        }
                    }
                },
                "@owner": {
                    "object": "appPledge",
                    "form": "ownerEditForm",
                    "required": true
                }
            }
        },
        "pledge-OTHER-Form": {
            "title": "Прочие",
            "className": "vertical",
            "$": {
                "description": {
                    "label": "Наименование залога",
                    "control": "TextEdit",
                    "required": true
                },
                "@cost": {
                    "className": "horizontal",
                    "$": {
                        "mortgage_value": {
                            "label": "Залоговая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "mortgage_value_currency"
                            },
                            "required": true
                        },
                        "fair_value": {
                            "label": "Справедливая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "fair_value_currency"
                            },
                            "required": true
                        }
                    }
                },
                "@owner": {
                    "object": "appPledge",
                    "form": "ownerEditForm",
                    "required": true
                }
            }
        },
        "pledge-BOND-Form": {
            "title": "Ценные бумаги",
            "className": "vertical",
            "$": {
                "description": {
                    "label": "Наименование залога",
                    "control": "TextEdit",
                    "required": true
                },
                "@cost": {
                    "className": "horizontal",
                    "$": {
                        "mortgage_value": {
                            "label": "Залоговая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "mortgage_value_currency"
                            },
                            "required": true
                        },
                        "fair_value": {
                            "label": "Справедливая стоимость",
                            "style": {
                                "width": "280px"
                            },
                            "control": "CurrencyField",
                            "controlOpts": {
                                "currencyAttr": "fair_value_currency"
                            },
                            "required": true
                        }
                    }
                },
                "issuer": {
                    "$": {
                        "@client": {
                            "object": "appPledge",
                            "form": "clientEditForm",
                            "params": {
                                "label": "Эмитент"
                            },
                            "required": true
                        }
                    }
                },
                "@owner": {
                    "object": "appPledge",
                    "form": "ownerEditForm",
                    "required": true
                }
            }
        },
        "ownerEditForm": {
            "$": {
                "owner": {
                    "$": {
                        "@owner": {
                            "object": "appPledge",
                            "form": "clientEditForm",
                            "params": {
                                "label": "Правообладатель",
                                "enableIdentifyJur$": "params.enableIdentifyJur"
                            },
                            "actions": {
                                "onClientModified": {
                                    "name": "onOwnerModified"
                                }
                            }
                        }
                    }
                }
            }
        },
        "selectClientDepositDialog": {
            "title": "Поиск депозита клиента",
            "style": {
                "width": "1000px"
            },
            "$": {
                "@fields": {
                    "className": "vertical",
                    "$": {
                        "clientType": {
                            "init": "borrower",
                            "control": "RadioGroup",
                            "controlProps": {
                                "row": true,
                                "list": [
                                    {
                                        "value": "borrower",
                                        "name": "Заёмщик"
                                    },
                                    {
                                        "value": "any",
                                        "name": "Любой клиент"
                                    }
                                ]
                            },
                            "actions": {
                                "onChange": {
                                    "name": "onChangeClientType"
                                }
                            }
                        },
                        "@any": {
                            "className": "vertical",
                            "$": {
                                "lookupClient": {
                                    "className": "horizontal",
                                    "$": {
                                        "inn": {
                                            "label": "ИНН",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "TextEdit",
                                            "actions": {
                                                "onChange": {
                                                    "name": "refresh"
                                                }
                                            }
                                        },
                                        "pinfl": {
                                            "label": "ПИНФЛ",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "TextEdit",
                                            "actions": {
                                                "onChange": {
                                                    "name": "refresh"
                                                }
                                            }
                                        },
                                        "nibbd": {
                                            "label": "НИББД",
                                            "style": {
                                                "width": "280px"
                                            },
                                            "control": "TextEdit",
                                            "actions": {
                                                "onChange": {
                                                    "name": "refresh"
                                                }
                                            }
                                        },
                                        ".btnFind": {
                                            "label": "Найти",
                                            "control": "Button",
                                            "controlProps": {
                                                "style": {
                                                    "textTransform": "none"
                                                },
                                                "color": "primary"
                                            },
                                            "readOnly$": "!(mem.inn || mem.pinfl || mem.nibbd) || false",
                                            "action": {
                                                "js": "task.events.fireEvent('onRefreshDeposits');"
                                            }
                                        }
                                    },
                                    "actions": {
                                        "refresh": {
                                            "js": ";"
                                        }
                                    }
                                }
                            },
                            "visible$": "mem.clientType=='any'"
                        },
                        "|deposits": {
                            "control": "ListTable",
                            "controlProps": {
                                "style": {
                                    "height": "200px"
                                },
                                "gridOptions": {
                                    "domLayout": "normal"
                                },
                                "context": {
                                    "formContext$": "context",
                                    "formParams$": "params"
                                }
                            },
                            "controlOpts": {
                                "rowModelType": "infinite",
                                "id": "id",
                                "refreshEvent": "onRefreshDeposits",
                                "compact": true,
                                "isRowSelectable": "console.log('isRowSelectable', arguments['0'])||(params.node.data.amountRest>0 && (!params.pledgeMaxDate || params.pledgeMaxDate > params.node.data.endDate))",
                                "columns!": {
                                    "productName": {
                                        "label": "Продукт",
                                        "width": 140
                                    },
                                    "amount": {
                                        "label": "Сумма",
                                        "width": 160,
                                        "cellStyle": {
                                            "textAlign": "right"
                                        },
                                        "fields|": {
                                            "amount": {
                                                "format": "currency"
                                            },
                                            "currency": {}
                                        }
                                    },
                                    "fromDate": {
                                        "label": "Дата начала",
                                        "width": 120,
                                        "format": "date"
                                    },
                                    "toDate": {
                                        "label": "Дата окончания",
                                        "width": 120,
                                        "format": "date"
                                    },
                                    "accountNo": {
                                        "label": "Номер счета",
                                        "width": 200
                                    },
                                    "clientName": {
                                        "label": "Наименование клиента",
                                        "flex": 1
                                    }
                                }
                            },
                            "actions": {
                                "onGetRows": [
                                    {
                                        "js": "mem.clientType=='borrower' && backend.post('/aoa/execObjectMethod', {object: 'appPledge', method: 'getClientDeposits', params: {clientCode: context.client.code}}).then((r)=>{onSuccess(r)})"
                                    },
                                    {
                                        "js": "if(mem.clientType=='any'){ if(mem.lookupClient.inn || mem.lookupClient.pinfl || mem.lookupClient.nibbd){backend.post('/aoa/execObjectMethod', {object: 'loanapp', method: 'identifyClient', params: mem.lookupClient}).then((c)=>{c && backend.post('/aoa/execObjectMethod', {object: 'appPledge', method: 'getClientDeposits', params: {clientCode: c.code}}).then((r)=>{onSuccess(r)}) || onSuccess(null)})}else{onSuccess(null);} }"
                                    }
                                ]
                            }
                        }
                    },
                    "actions": {}
                },
                "@buttons": {
                    "className": "horizontal",
                    "style": {
                        "justifyContent": "flex-end"
                    },
                    "$": {
                        "cancel": {
                            "label": "Отменить",
                            "control": "Button",
                            "controlProps": {
                                "style": {
                                    "textTransform": "none"
                                },
                                "variant": "text",
                                "color": "primary"
                            },
                            "action": {
                                "js": "actions.close()",
                                "disableUpdate": true
                            }
                        },
                        "apply": {
                            "label": "Выбрать",
                            "control": "Button",
                            "controlProps": {
                                "style": {
                                    "textTransform": "none"
                                },
                                "variant": "contained",
                                "color": "primary"
                            },
                            "readOnly$": "!context.selectedDeposit",
                            "action": [
                                {
                                    "name": "onDepositSelected",
                                    "params": {
                                        "deposit$": "context.selectedDeposit"
                                    }
                                },
                                {
                                    "js": "actions.close();",
                                    "disableUpdate": true
                                }
                            ]
                        }
                    }
                }
            },
            "actions": {
                "onFormCreated": {
                    "js": "context.client=params.client;"
                },
                "onSelectionChanged": {
                    "js": "context.selectedDeposit=selectedRow;"
                },
                "onRowDoubleClicked": [
                    {
                        "js": "if(!context.selectedDeposit) {throw 'Abort';}"
                    },
                    {
                        "name": "onDepositSelected",
                        "params": {
                            "deposit$": "context.selectedDeposit"
                        }
                    },
                    {
                        "js": "actions.close();",
                        "disableUpdate": true
                    }
                ],
                "onChangeClientType": {
                    "js": "context.selectedDeposit=null; task.events.fireEvent('onRefreshDeposits', {deselectAll: true});"
                }
            }
        }
    },
    "methods": {
        "getPledgeTypes": {
            "sql": {
                "params": []
            },
            "script": {
                "params": [],
                "py": "data = [\n    {\n        'code': 'REALTY-RESIDENTAL', 'name': 'Жилая недвижимость', 'baseType': 'REALTY',\n        'ens_code': '21', 'ens_name': 'Недвижимость'\n    },\n    {\n        'code': 'REALTY-NON-RESIDENTAL', 'name': 'Нежилая недвижимость', 'baseType': 'REALTY',\n        'ens_code': '21', 'ens_name': 'Недвижимость'\n    },\n    {\n        'code': 'AUTO', 'name': 'Автотранспорт', 'baseType': 'AUTO',\n        'ens_code': '23', 'ens_name': 'Транспортные средства'\n    },\n    {\n        'code': 'SURETY', 'name': 'Гарантия/Поручительство', 'baseType': 'GRNT',\n        'ens_code': '41', 'ens_name': 'Поручительство третьих лиц',\n    },\n    {\n        'code': 'INSURANCE', 'name': 'Страховой полис', 'baseType': 'INSUR',\n        'ens_code': '51', 'ens_name': 'Страховой полис'\n    },\n    {\n        'code': 'DEPO', 'name': 'Депозит', 'baseType': 'DEPO', 'deposit': {'depositType': 'internal'},\n        'ens_code': '25', 'ens_name': 'Депозит'\n    },\n    {\n        'code': 'EQUIP', 'name': 'Оборудование', 'baseType': 'EQUIP',\n        'ens_code': '24', 'ens_name': 'Оборудование'\n    },\n    {\n        'code': 'GRNT', 'name': 'Гарантии', 'hide': True\n    },\n    {\n        'code': 'GOOD', 'name': 'Товары в обороте', 'baseType': 'GOOD',\n    },\n    {\n        'code': 'STEAD', 'name': 'Земельный участок', 'baseType': 'STEAD',\n    },\n    {\n        'code': 'OTHER', 'name': 'Прочие', 'baseType': 'OTHER',\n    },\n    {\n        'code': 'BOND', 'name': 'Ценные бумаги', 'baseType': 'BOND',\n    }\n\n]"
            }
        },
        "getClientDeposits": {
            "sql": {
                "params": [
                    "clientCode"
                ],
                "sqlType": "query",
                "database": "colvir_cbs",
                "sql": "select\n    d.id \"id\",\n    d.DEP_ID as DEA_DEP_ID,\n    d.ID as DEA_ID,\n    o.CODE \"code\",\n    c.LONGNAME \"productName\",\n    d.SDOK \"amount\",\n    t_PkgVal.fGetCode(o.VAL_ID) \"currency\",\n    \n    -- Остаток счета депозита \n    decode(\n        C_PkgGrant.fChkUsrBalAccSee(dd.ACC_DEP_ID,dd.ACC_ID),\n        1, -T_PkgAccBal.fAccBal(dd.ACC_DEP_ID, dd.ACC_ID, P_OPERDAY, 0, o.VAL_ID),\n        to_number(null)\n    ) \"amountRest\",\n    \n    g.CODE \"clientCode\",\n    G_PkgCliName.fCliLongName(g.DEP_ID, g.ID) \"clientName\",\n    o.DORD \"fromDate\",\n    to_date(substr(T_PkgDeaPrm.fParByCode(d.ID, d.DEP_ID, 'DATE_PRC_END'),1,30)) \"endDate\",\n    G_PkgAccBln.fGetCodeAccByIdAcc(dd.ACC_ID, dd.ACC_DEP_ID) \"accountNo\"\nfrom T_ORD o, T_DEACLS c, T_DEA d, D_DEA dd, G_CLI g\nwhere o.DEP_ID = d.DEP_ID and o.ID = d.ID\n  and c.ID = d.DCL_ID and d.CLOSEFL = 0\n  and dd.DEP_ID = d.DEP_ID and dd.ID = d.ID\n  and g.DEP_ID = d.CLI_DEP_ID and g.ID = d.CLI_ID\n  and T_PkgDeaPrm.fClsParByCode(d.DCL_ID, 'D_DEPO_TYPE') in (D_Const_PER, D_Const_GRN, D_Const_DEM)\n  and g.CODE= :clientCode\n"
            },
            "script": {
                "params": [],
                "py": ""
            }
        }
    },
    "lists": {},
    "references": {},
    "js": {}
}