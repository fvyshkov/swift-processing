# Transaction as Process Implementation Guide

## Overview
This document describes how to implement transactions as processes in the swift-processing system. Before implementing, review the documentation in the `docs/` folder, particularly:
- `SWIFT_PROCESSING_ARCHITECTURE.md` - for overall system architecture
- `PROCESS_MANAGEMENT_GUIDE.md` - for process management concepts
- `DATABASE_PATTERNS.md` - for database structure patterns
- `JSON_STRUCTURE_GUIDE.md` - for JSON object structure

## Implementation Steps

### 1. Create Transaction Process Type
In `swift.objects/ao/swiftIncome.json`, locate the `DB_CREATE_FULL` method and add a new process type:

**Table:** `process_type`
**Fields to populate:**
- `code`: "TRANSACTION"
- `name`: "Transaction Process"
- `attributes_table`: "transaction_attributes" (create corresponding table)
- `initial_state_id`: (reference to "RECEIVED" state ID)

### 2. Create Transaction Attributes Table
In the same `DB_CREATE_FULL` method, add:
```sql
CREATE TABLE transaction_attributes (
    id INTEGER PRIMARY KEY,
    process_id INTEGER NOT NULL,
    transaction_ref VARCHAR(50),
    amount DECIMAL(15,2),
    currency VARCHAR(3),
    sender_account VARCHAR(50),
    receiver_account VARCHAR(50),
    status VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (process_id) REFERENCES process(id)
);
```

### 3. Define Process States
In `swift.objects/ao/processState.json`:
- Add state "RECEIVED" (initial state for transactions)
- Add state "PROCESSED" (final processed state)

### 4. Define Process Operations
In `swift.objects/ao/processOperation.json`:
- Add operation "PROCESS_TRANSACTION"
  - From state: "RECEIVED"
  - To state: "PROCESSED"
- Add operation "CANCEL_TRANSACTION"
  - From state: "PROCESSED"
  - To state: "RECEIVED"

### 5. Update Process Management UI
In `swift.objects/ao/processManagement.json`:
- Add transaction process type to the process type list
- Create edit form for transaction attributes
- Update list views to display transaction-specific fields

### 6. Implementation Locations to Update
When implementing, ensure to update ALL of these locations:
1. **swiftIncome.json** - DB_CREATE_FULL method for schema
2. **processType.json** - getTypeList, getType, saveType methods
3. **processManagement.json** - UI forms and lists
4. **processOperation.json** - operation definitions
5. **processState.json** - state definitions
6. Any SQL queries that reference process tables
7. Python methods that create or manage processes

### 7. Process Creation Logic
When creating a transaction process:
- Set `doc_id` field in `process` table (no FK constraint)
- Initialize with "RECEIVED" state
- Populate transaction_attributes with transaction details
- Create audit trail entry

## Important Notes
- The `process` table's `doc_id` field does NOT have a foreign key constraint
- Always check existing implementations using grep before creating new files
- DB schema is centralized in swiftIncome.json's DB_CREATE_FULL method
- When modifying fields, search and update ALL usage locations
- Follow patterns established in existing process types